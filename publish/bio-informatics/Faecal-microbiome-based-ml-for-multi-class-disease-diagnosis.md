---
title: Faecal microbiome based ML for multi class disease diagnosis
date: 2022-11-10
---

> Ref paper.
> 
> https://pubmed.ncbi.nlm.nih.gov/36357393/
> https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9649010/

---
#### การวินิจฉัยโรค microbiome ในอุจจาระ โดย ML (ความไม่สมดุลของจุลินทรีย์ในลำไส้ หรือที่เรียกว่า “dysbiosis” มีส่วนในการก่อให้เกิดโรคต่างๆ ในมนุษย์)

#### Introduction

งานวิจัยนี้ใช้ ML สำหรับการวินิจฉัยโรคโดยอิงจากข้อมูล **microbiome** ในอุจจาระ โดยใช้โมเดล multi-class classification ซึ่งสามารถตรวจจับความแตกต่างของจุลินทรีย์ที่มีลักษณะเฉพาะสำหรับหลายโรค ในการศึกษาใช้ข้อมูลจากตัวอย่างอุจจาระของผู้เข้าร่วม 2,320 คนที่มี 9 phenotypes ของโรค เช่น มะเร็งลำไส้ใหญ่, โรค Crohn's, โรคลำไส้อักเสบ (IBS), โรคอ้วน, และกลุ่มควบคุมที่มีสุขภาพดี เป้าหมายคือการพัฒนาโมเดล ML เพื่อวินิจฉัยโรคหลายชนิดได้อย่างมีประสิทธิภาพสูง

ความไม่สมดุลของจุลินทรีย์ในลำไส้ หรือที่เรียกว่า “dysbiosis” มีส่วนในการก่อให้เกิดโรคต่างๆ ในมนุษย์ การพัฒนา microbial markers ในปัจจุบันส่วนใหญ่ใช้โมเดล binary classifiers

> ในงานวิจัยนี้ ได้พัฒนาชุดข้อมูลขนาดใหญ่ที่สุดที่ครอบคลุมหลายโรคจากแหล่งเดียว ใช้โมเดล ML แบบหลายประเภทเพื่อทำนายโรคต่างๆ โดยใช้ข้อมูล microbiome ในอุจจาระระดับสายพันธุ์ และยืนยันผลลัพธ์ด้วยข้อมูลจากชุดข้อมูล metagenome สาธารณะจากประชากรต่างๆ

---
### Results

จาก metagenomic sequencing ของตัวอย่างอุจจาระจากกลุ่มประชากรชาวฮ่องกงเชื้อสายจีนจำนวน 2,320 คน (อายุเฉลี่ย 54.9 ปี, ผู้หญิง 48.7%) ซึ่งครอบคลุมกลุ่มโรค 9 ประเภท ได้แก่ มะเร็งลำไส้ใหญ่ (CRC, 174 คน), เนื้องอกในลำไส้ใหญ่ (CA, 168 คน), โรคโครห์น (CD, 200 คน), ลำไส้อักเสบชนิด ulcerative colitis (UC, 147 คน), โรคลำไส้แปรปรวนชนิด IBS-D (145 คน), โรคอ้วน (148 คน), โรคหัวใจและหลอดเลือด (CVD, 143 คน), กลุ่มอาการหลังการติดเชื้อ COVID-19 (PACS, 302 คน) และกลุ่มควบคุมที่มีสุขภาพดี (893 คน) โดยรวมได้รับข้อมูลลำดับพันธุกรรมกว่า 14.3TB และได้ระบุสายพันธุ์แบคทีเรียจำนวน 1,208 สายพันธุ์ ซึ่งในจำนวนนี้ 325 สายพันธุ์มีความหนาแน่นสัมพัทธ์มากกว่า 0.15% และพบในมากกว่า 5% ของกลุ่มตัวอย่าง
#### Shared microbiome signatures across different phenotypes

> ความแตกต่างในความหลากหลายของแบคทีเรีย (Shannon) และความอุดมสมบูรณ์ (number of species) ในกลุ่มโรคต่าง ๆ โดยพบว่าค่าทั้งสองนี้มีการเปลี่ยนแปลงตามกลุ่มโรค 

ในส่วนนี้ ผู้วิจัยสังเกตเห็นว่ามีความแตกต่างในความหลากหลายและความหนาแน่นของแบคทีเรีย (เช่น Shannon diversity และ number of species) ในโรคที่ต่างกัน แต่พบว่าดัชนีเหล่านี้ไม่ค่อยเสถียรนักในการใช้เป็นตัวบ่งชี้สุขภาพหรือโรค 

>ผู้วิจัยใช้วิธีการ **MaAsLin2** เพื่อปรับค่าตัวแปรรบกวน (confounders) และค้นหาความสัมพันธ์ที่สำคัญระหว่างสายพันธุ์จุลินทรีย์กับ phenotypes ของโรค จากนั้นได้พบว่ามี **215 สายพันธุ์แบคทีเรีย** ที่เชื่อมโยงกับโรคต่าง ๆ อย่างมีนัยสำคัญ ซึ่งบ่งชี้ว่ามีการแชร์สัญญาณจุลินทรีย์ระหว่างโรคต่าง ๆ

หลังจากทำการวิเคราะห์องค์ประกอบจุลินทรีย์ในระดับสปีชีส์ พบว่ามีความสัมพันธ์ระหว่างจุลินทรีย์ 215 ชนิดกับโรค 9 ชนิด (FDR <0.05) และ 94% ของจุลินทรีย์เหล่านี้มีความสัมพันธ์กับมากกว่า 2 โรค ตัวอย่างเช่น 

> **Klebsiella pneumoniae** เชื่อมโยงกับโรค Crohn's, มะเร็งลำไส้ใหญ่, โรคอ้วน, และโรคอื่นๆ ในขณะที่ **Roseburia intestinalis** เป็นจุลินทรีย์ที่เกี่ยวข้องกับสุขภาพที่ดี ผลลัพธ์เหล่านี้ชี้ให้เห็นถึงลักษณะการใช้ร่วมกันของ microbiome ในหลายโรค 

อย่างไรก็ตาม เมื่อทดสอบโมเดลแบบ binary (เช่น แยกโรคเดียวออกจากกลุ่มควบคุม) พบว่าโมเดล binary มีอัตราการวินิจฉัยผิดพลาดสูง (เฉลี่ย 0.52) ซึ่งแสดงให้เห็นว่าโมเดล binary ไม่สามารถจับลักษณะเฉพาะของโรคได้อย่างดี

#### Development of faecal microbiome-based multi-class diagnosis model

![[Pasted image 20240912223929.png]]

การวิเคราะห์นี้พัฒนาขึ้นเป็นโมเดล multi-class classification โดยสามารถจัดการกับปัจจัยที่ซับซ้อนจากโรคที่ไม่เกี่ยวข้อง โดยผู้วิจัยใช้ตัวอย่างอุจจาระจากกลุ่มตัวอย่าง 2,320 คนที่มีโรคต่างๆ รวม 9 โรค (เช่น มะเร็งลำไส้ใหญ่, โรค Crohn's, โรคลำไส้แปรปรวน ฯลฯ) โดยมีการแบ่งข้อมูลเป็นชุดทดสอบ (70%) และชุดทดสอบอิสระ (30%) เพื่อประเมินประสิทธิภาพของโมเดล

> สร้างโมเดล ML 5 รูปแบบ ได้แก่ RF, K-nearest neighbours (KNN), multi-layer perceptron (MLP), support vector machine (SVM) และ graph convolutional neural network (GCN)

> ผลการฝึกโมเดลแสดงว่าโมเดล **RF multi-class** มีประสิทธิภาพสูงที่สุดในหมู่โมเดลทั้งหมด โดยมีค่า **AUROC** เฉลี่ย 0.90-0.99 สำหรับการทำนายโรคต่าง ๆ

> เมื่อทดสอบโมเดล RF multi-class กับชุดข้อมูลทดสอบ โมเดลแสดงให้เห็นถึงประสิทธิภาพการวินิจฉัยที่ดี โดยมีค่า **sensitivity** ระหว่าง 0.81 ถึง 0.95 และ **specificity** ระหว่าง 0.76 ถึง 0.98 ซึ่งชี้ให้เห็นถึงความสามารถในการวินิจฉัยที่ดีมาก

#### Validation of multi-class model on independent datasets

ผู้วิจัยได้ทำการทดสอบโมเดล RF multi-class กับชุดข้อมูลภายนอกที่รวบรวมจาก 12 ชุดข้อมูลสาธารณะ (จากเอเชีย, ยุโรป, และอเมริกาเหนือ) ที่ประกอบด้วยตัวอย่างทั้งหมด 1,597 ตัวอย่าง พบว่าโมเดลสามารถวินิจฉัยโรคได้อย่างแม่นยำ 

โดยค่า AUROC เฉลี่ยอยู่ระหว่าง 0.69 ถึง 0.91 ซึ่งยืนยันว่าโมเดลนี้มีความเสถียรและสามารถนำไปใช้ในประชากรต่าง ๆ ได้อย่างกว้างขวาง โมเดลยังแสดงผลการทำนายที่ดีสำหรับการวินิจฉัยโรคที่ไม่รวมอยู่ในชุดข้อมูลเทรน เช่น โรคตับแข็ง และโรคท้องผูกแบบ IBS (IBS-C)

#### Associations between bacterial features and phenotypes

ผู้วิจัยได้วิเคราะห์ความสัมพันธ์ระหว่างแบคทีเรีย 50 ชนิดที่มีผลต่อโมเดลกับโรคต่างๆ ผลการวิเคราะห์พบว่ามีความสัมพันธ์ที่สำคัญ 363 ความสัมพันธ์ (FDR <0.05) ซึ่งแสดงให้เห็นถึงลักษณะเฉพาะของ microbiome ที่เชื่อมโยงกับแต่ละโรค ตัวอย่างเช่น โรค **PACS** พบว่ามีแบคทีเรีย **Bacteroides vulgatus** และ **Bacteroides xylanisolvens** เพิ่มขึ้นอย่างมาก 

ในขณะที่โรค Crohn's พบว่ามีการลดลงของ **Bacteroides uniformis** และ **Bacteroides vulgatus** นอกจากนี้ยังพบว่ามะเร็งลำไส้ใหญ่มีการเพิ่มขึ้นอย่างมีนัยสำคัญของแบคทีเรีย **Parvimonas micra** ซึ่งสามารถใช้เป็น biomarker สำหรับวินิจฉัยโรคนี้ได้

> ผู้วิจัยได้ทำการเชื่อมโยง **50 สายพันธุ์จุลินทรีย์** ชั้นนำที่มีบทบาทสำคัญในโมเดล RF กับโรคต่าง ๆ เพื่อหาข้อสังเกตเพิ่มเติมเกี่ยวกับบทบาทของจุลินทรีย์ในโรค

![[Pasted image 20240912225622.png]]

---
## Methods

การวิจัยนี้ได้ทำการเก็บตัวอย่างอุจจาระจากผู้เข้าร่วมและใช้เทคนิค metagenomic sequencing เพื่อวิเคราะห์ **microbiome** ของผู้ป่วย โดยใช้เทคนิค **random forest (RF)**, **SVM**, และ **K-nearest neighbours (KNN)** ในการสร้างโมเดล ML สำหรับการวิเคราะห์การจำแนกโรคหลายชนิด ข้อมูลถูกแบ่งเป็นชุดทดสอบ (70%) และชุดทดสอบ (30%) เพื่อทดสอบประสิทธิภาพของโมเดล

#### 1.  **Faecal DNA extraction and sequencing**

ในส่วนนี้ ดีเอ็นเอจากตัวอย่างอุจจาระถูกสกัดโดยใช้ชุด **Qiagen QIAamp DNA Stool Mini Kit** หลังจากที่ได้ผ่านการควบคุมคุณภาพเช่น Qubit 2.0 และ Agilent 2100 แล้ว ดีเอ็นเอที่สกัดได้จะถูกนำไปสร้างห้องสมุดดีเอ็นเอ (DNA libraries) โดยใช้ชุด **Nextera DNA Flex Library Preparation kit** และนำไปหาลำดับเบส (sequencing) ด้วยเครื่อง Illumina NextSeq 550 เพื่อให้ได้ข้อมูลลำดับเบสคู่ยาว 150 คู่

#### 2. **Microbiome profiling**

หลังจากได้ข้อมูลลำดับเบสแล้ว ข้อมูลดิบถูกกรองคุณภาพด้วยโปรแกรม **Trimmomatic** เพื่อตัดลำดับเบสที่มีคุณภาพต่ำและลำดับที่สั้นเกินไป จากนั้นจุลินทรีย์ที่ปนเปื้อนจากมนุษย์จะถูกกรองออกโดยใช้โปรแกรม **Kneaddata** หลังจากนั้นจึงใช้โปรแกรม **MetaPhlAn3** ในการกำหนดโปรไฟล์ microbiome เพื่อหาว่ามีแบคทีเรียชนิดใดบ้างในตัวอย่าง โดยข้อมูลที่มีปริมาณเฉลี่ยน้อยกว่า 0.15% และมีในตัวอย่างน้อยกว่า 5% จะถูกกรองออก

#### 3. **Microbiome analysis**

> All statistical analyses were done using R version 4.0.3. The ggpubr package ([https://github.com/kassambara/ggpubr](https://github.com/kassambara/ggpubr))

การวิเคราะห์ microbiome ทั้งหมดทำโดยใช้ **R** โดยมีการใช้ **Principal Coordinates Analysis (PCoA)** เพื่อตรวจจับกลุ่มตัวอย่างตามโปรไฟล์จุลินทรีย์ของแต่ละคน การวิเคราะห์ความแตกต่างระหว่างกลุ่มตัวอย่างทำโดยใช้ **PERMANOVA** และใช้การทดสอบ **MaAsLin2** เพื่อหาความสัมพันธ์ระหว่างสายพันธุ์จุลินทรีย์กับโรคต่าง ๆ โดยมีการปรับตัวแปรทางเทคนิคและชีวภาพ เช่น อายุ และความเข้มข้นของ DNA

ผลการวิเคราะห์ยืนยันว่าแบคทีเรียบางสายพันธุ์มีบทบาทสำคัญในโรคต่าง ๆ เช่น **Klebsiella pneumoniae** เชื่อมโยงกับโรคหลายชนิด เช่น CRC และ CD
#### 4. **Random Forest binary classifier**

โมเดล **Random Forest (RF)** ถูกนำมาใช้ในการทำนายแบบ binary โดยแบ่งข้อมูลออกเป็นชุดย่อยที่ครอบคลุมการเปรียบเทียบทุกคู่ของโรคและกลุ่มควบคุม โมเดลได้รับการฝึกด้วยข้อมูล 70% ของชุดฝึก และทำการประเมินผลกับชุดทดสอบ 30% ของข้อมูล
#### 5. **Machine learning for diagnosis of multi-diseases**

> Multi-class models are implemented by Python 3.6.7 using standard libraries that are publicly available: pandas (0.23.4), numpy (1.14.5), scikit-learn (1.1), and matplotlib (2.2.3).

> การทดสอบโมเดล multi-class classification ใช้ข้อมูลจาก phenotypes ของโรค 9 ชนิด โดยโมเดลที่ดีที่สุดคือ **RF multi-class** ซึ่งได้ค่า AUROC เฉลี่ย 0.90 ถึง 0.99 สำหรับการทำนายโรคต่าง ๆ ในชุดทดสอบ

โดย สำหรับแต่ละ phenotypes ตัวอย่างถูกแบ่งแบบสุ่มเป็นชุดฝึก (70% ของตัวอย่าง, รวม n = 1724) และชุดทดสอบสำหรับการประเมินที่เป็นอิสระ (30% ที่เหลือ, รวม n = 696)

>โดยสัดส่วนคลาสให้สมดุลทั้งในกลุ่มตัวอย่าง, ชุดฝึก และชุดทดสอบ โมเดลที่ใช้เป็นตัวจัดประเภทได้แก่ Random Forests (RF), K-nearest Neighbours (KNN), Multi-layer Perceptron (MLP) และ Support Vector Machine (SVM) 

โมเดลการจำแนกประเภทแบบ multi-class ถูกสร้างโดยใช้Random Forests (RF), K-nearest Neighbours (KNN), Multi-layer Perceptron (MLP) และ Support Vector Machine (SVM)  ซึ่งได้รับการฝึกด้วยข้อมูลที่เป็นโปรไฟล์จุลินทรีย์ของผู้ป่วยในระดับสายพันธุ์ หลังจากทำการประเมินผลโดยใช้ cross-validation แล้ว โมเดลที่ดีที่สุดจะถูกทดสอบกับข้อมูลทดสอบที่เก็บไว้ เพื่อประเมินประสิทธิภาพในการทำนายโรค

 โดย RF multi-class classifier ถูกปรับแต่งจากการตั้งค่าเริ่มต้นของ SciKit-learn โดยตั้งค่า n_estimators = 2000 และ class_weight = balanced ขณะที่ KNN, SVM และ MLP ใช้การตั้งค่าเริ่มต้นจาก SciKit-learn 
 
#### 6. **Model evaluation**

โมเดลถูกประเมินโดยใช้ **AUROC** ซึ่งเป็นตัวชี้วัดที่นิยมใช้ในการประเมินความสามารถของโมเดลในการจำแนกโรค โดยค่า AUROC ที่สูงกว่าหมายถึงความสามารถในการทำนายที่ดีกว่า

> ผลลัพธ์แสดงว่าโมเดล RF multi-class มีความเสถียรและมีความสามารถในการทำนายโรคด้วยความแม่นยำสูง แม้จะแบ่งข้อมูลออกเป็นหลายชุด

---
### Discussion

งานวิจัยนี้แสดงให้เห็นถึงความเป็นไปได้ในการใช้ข้อมูล microbiome จากอุจจาระร่วมกับ **machine learning** ในการวินิจฉัยโรคหลายชนิด โมเดล ML ที่พัฒนานี้สามารถนำไปใช้ทางคลินิกเพื่อเสริมสร้างการวินิจฉัยโรคและติดตามการตอบสนองต่อการรักษา

### ความท้าทายและข้อจำกัด

- ยังมีข้อจำกัดในการศึกษาที่ครอบคลุมเฉพาะบางโรค การรวมข้อมูลโรคอื่น ๆ จะช่วยเพิ่มคุณค่าให้กับโมเดลวินิจฉัยนี้
- ความจำเป็นในการสำรวจเพิ่มเติมเกี่ยวกับกลไกการเชื่อมโยงระหว่าง microbiome กับโรค เพื่อช่วยในการทำความเข้าใจพยาธิกำเนิดของโรค